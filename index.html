<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Trek Trivia</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        body {
            background-color: #0A0A1A;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 100%;
            padding: 20px;
        }

        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 36pt;
            color: gold;
            margin-top: 20px;
        }

        .description {
            font-size: 16pt;
            color: white;
            margin-top: 30px;
            word-wrap: break-word;
            white-space: normal;
        }

        .question-count {
            font-size: 16pt;
            color: white;
            margin-top: 30px;
        }

        .button-container {
            margin-top: 30px;
        }

        .question-button,
        .answer-button,
        .next-button,
        .play-again-button,
        .quit-button {
            font-size: 16pt;
            color: gold;
            background: linear-gradient(to bottom, #222 0%, #444 50%, #000 100%);
            border: 2px solid #666;
            box-shadow: 0 5px #666;
            width: 150px;
            padding: 10px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 10px;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease;
        }

        .question-button:hover,
        .answer-button:hover,
        .next-button:hover,
        .play-again-button:hover,
        .quit-button:hover {
            background: linear-gradient(to bottom, #333 0%, #555 50%, #111 100%);
        }

        .question-button:active,
        .answer-button:active,
        .next-button:active,
        .play-again-button:active,
        .quit-button:active {
            box-shadow: 0 2px #666;
            transform: translateY(3px);
        }

        .next-button,
        .play-again-button,
        .quit-button {
            margin: 30px auto;
            display: block;
        }

        .countdown-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 24pt;
            color: gold;
            text-align: center;
            margin-top: 30px;
        }

        .countdown-timer {
            font-size: 18pt;
            color: white;
            text-align: center;
            margin-top: 20px;
        }

        .quiz-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 34pt;
            color: gold;
            text-align: center;
            margin-top: 30px;
        }

        .series-movie {
            font-size: 16pt;
            color: white;
            margin-top: 20px;
            border: 1px solid gold;
            border-radius: 5px;
            padding: 15px;
            display: inline-block;
            max-width: 80%;
            box-sizing: border-box;
            word-wrap: break-word;
        }

        .question-description {
            font-size: 16pt;
            color: white;
            margin-top: 10px;
            border: 1px solid gold;
            border-radius: 5px;
            padding: 15px;
            display: inline-block;
            max-width: 80%;
            box-sizing: border-box;
            word-wrap: break-word;
        }

        div.question {
            font-family: Arial, sans-serif !important;
            font-size: 16pt;
            color: gold;
            text-align: center;
            margin: 30px auto 0;
            max-width: calc(100% - 40px);
            box-sizing: border-box;
            word-wrap: break-word;
        }

        .answers {
            margin-top: 30px;
            text-align: center;
            position: relative;
        }

        .feedback {
            font-size: 16pt;
            text-align: center;
            margin-top: 30px;
        }

        .narrative {
            font-size: 16pt;
            text-align: center;
            margin-top: 30px;
            color: white;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
            word-wrap: break-word;
        }

        .score {
            font-family: 'Orbitron', sans-serif;
            font-size: 16pt;
            color: gold;
            text-align: center;
            margin-top: 30px;
        }

        .completion-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 36pt;
            color: white;
            margin-top: 30px;
        }

        .completion-score {
            font-size: 16pt;
            color: white;
            margin-top: 20px;
        }

        .completion-thank-you {
            font-family: 'Orbitron', sans-serif;
            font-size: 30pt;
            color: gold;
            margin-top: 30px;
        }

        .image-container {
            text-align: center;
            margin-top: 30px;
        }

        .answer-image-container,
        .question-image-container {
            display: inline-block;
            vertical-align: top;
            border: 3px solid gold;
            border-radius: 10px;
            padding: 10px;
            margin: 20px;
            width: 212.5px;
            height: 212.5px;
            box-sizing: border-box;
            background-color: #0A0A1A;
        }

        .answer-image,
        .question-image {
            width: 187.5px;
            height: 187.5px;
            display: block;
            margin: 0 auto;
        }

        .table-container {
            margin: 20px auto;
            width: 80%;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
        }

        .result-table th,
        .result-table td {
            border: 2px solid #666;
            padding: 10px;
            color: gold;
            background: linear-gradient(to bottom, #222 0%, #444 50%, #000 100%);
            box-shadow: 0 5px #666;
            text-align: center;
            border-radius: 10px;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease;
        }

        .result-table th {
            font-size: 18pt;
        }

        .result-table td {
            font-size: 16pt;
        }

        .additional-message {
            margin-top: 20px;
            padding-bottom: 20px;
            font-size: 20pt;
            color: white;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            word-wrap: break-word;
        }

        @media (max-width: 600px) {
            .container {
                overflow-y: auto;
                height: 100vh;
            }

            .title,
            .quiz-title,
            .completion-title,
            .completion-thank-you {
                font-size: 6vw;
            }

            .description,
            .question-count,
            .countdown-timer,
            .series-movie,
            .question-description,
            .question,
            .feedback,
            .narrative,
            .score,
            .completion-score,
            .additional-message {
                font-size: 4vw;
            }

            .countdown-title {
                font-size: 5vw;
            }

            .question-button,
            .answer-button,
            .next-button,
            .play-again-button,
            .quit-button {
                font-size: 4vw;
                width: 60vw;
            }

            div.question {
                max-width: calc(100% - 40px);
            }

            .answer-image {
                width: 100px;
                height: 100px;
            }

            .question-image-container {
                width: 150px;
                height: 150px;
            }

            .question-image {
                width: 125px;
                height: 125px;
            }

            .result-table th,
            .result-table td {
                font-size: 3vw;
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="main-page" class="container">
        <div class="title">Star Trek Trivia</div>
        <div class="description">
            This may be the hardest Star Trek quiz you have ever taken. The quiz currently offers 184 questions, but will eventually offer up to 500 questions. You may choose to play 10, 25 or 50 questions. The quiz currently has questions pertaining to several episodes and movies, but will expand to also include all movies, episodes and will also include questions from The Animated Series, Lower Decks and Prodigy.
        </div>
        <div class="question-count">
            How Many Questions Would You Like to Attempt?
        </div>
        <div class="button-container">
            <button class="question-button">10</button>
            <button class="question-button">25</button>
            <button class="question-button">50</button>
        </div>
    </div>
    <div id="quiz-container"></div>
    <div id="result-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setupMainPageEventListeners();
            fetchAndShuffleImages();
        });

        function setupMainPageEventListeners() {
            document.querySelectorAll('.question-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const numberOfQuestions = parseInt(event.target.textContent, 10);
                    fetchAndShuffleQuestions(numberOfQuestions);
                });
            });
        }

        function fetchAndShuffleQuestions(number) {
            fetch('https://raw.githubusercontent.com/Lead-Role/ST-Trivia/main/Star%20Trek%20Trivia%2022.json')
                .then(response => response.json())
                .then(data => {
                    const groupedQuestions = groupQuestionsBySeries(data);
                    const selectedQuestions = selectQuestionsFromGroups(groupedQuestions);
                    const shuffledQuestions = selectedQuestions.sort(() => 0.5 - Math.random()).slice(0, number);
                    startCountdown(shuffledQuestions);
                })
                .catch(error => console.error('Error fetching questions:', error));
        }

        function groupQuestionsBySeries(questions) {
            const grouped = {};
            questions.forEach(question => {
                const series = question['Series / Movie'];
                if (!grouped[series]) {
                    grouped[series] = [];
                }
                grouped[series].push(question);
            });
            return grouped;
        }

        function selectQuestionsFromGroups(groupedQuestions) {
            const selectedQuestions = [];
            for (const series in groupedQuestions) {
                const questions = groupedQuestions[series];
                const shuffled = questions.sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 5);
                selectedQuestions.push(...selected);
            }
            return selectedQuestions;
        }

        function startCountdown(questions) {
            document.body.innerHTML = `
                <div class="countdown-title">You have chosen to answer ${questions.length} questions</div>
                <div class="countdown-timer">Your game will begin in <span id="countdown">10</span> seconds</div>
            `;

            let timeLeft = 10;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                timeLeft--;
                countdownElement.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    startQuiz(questions);
                }
            }, 1000);
        }

        function startQuiz(questions) {
            let currentQuestionIndex = 0;
            let correctAnswers = 0;
            const seriesCount = {};

            function showQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    showQuizComplete(correctAnswers, currentQuestionIndex, seriesCount);
                    return;
                }

                const question = questions[currentQuestionIndex];
                const series = question['Series / Movie'];
                if (!seriesCount[series]) {
                    seriesCount[series] = { total: 0, correct: 0, incorrect: 0 };
                }
                seriesCount[series].total++;

                const answers = [
                    { text: question['Answer 1'], isCorrect: question['Answer 1'] === question['Correct Answer'] },
                    { text: question['Answer 2'], isCorrect: question['Answer 2'] === question['Correct Answer'] },
                    { text: question['Answer 3'], isCorrect: question['Answer 3'] === question['Correct Answer'] },
                    { text: question['Answer 4'], isCorrect: question['Answer 4'] === question['Correct Answer'] }
                ];
                answers.sort(() => 0.5 - Math.random());

                document.body.innerHTML = `
                    <div class="quiz-title">Star Trek Trivia Quiz</div>
                    <div class="series-movie">Series / Movie: ${question['Series / Movie']}</div>
                    <div class="question-description">Description: ${question.Description}</div>
                    <div class="question">${question.Question}</div>
                    <div class="answers">
                        ${answers.map(answer => `
                            <button class="answer-button" data-correct="${answer.isCorrect}" style="font-size: ${getFontSizeForAnswer(answer.text)}px;">${answer.text}</button>
                        `).join('')}
                    </div>
                    <div id="question-image-container" class="question-image-container">
                        <img src="${question.Images}" class="question-image" alt="Question Image">
                    </div>
                    <div id="feedback" class="feedback"></div>
                    <div id="narrative" class="narrative"></div>
                    <div id="score" class="score">You have answered ${correctAnswers} out of ${currentQuestionIndex} questions correctly</div>
                    <button id="next-button" class="next-button" style="display: none;">Next Question</button>
                `;

                document.querySelectorAll('.answer-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const isCorrect = event.target.getAttribute('data-correct') === 'true';
                        const feedbackElement = document.getElementById('feedback');
                        const narrativeElement = document.getElementById('narrative');
                        const questionImageContainer = document.getElementById('question-image-container');
                        questionImageContainer.innerHTML = '';
                        if (isCorrect) {
                            feedbackElement.innerHTML = `Correct: ${question['Correct Answer']}`;
                            feedbackElement.style.color = 'limegreen';
                            correctAnswers++;
                            seriesCount[series].correct++;
                            questionImageContainer.innerHTML = `
                                <img id="answer-image" class="answer-image" src="${getRandomImage(correctImages)}" alt="Answer Image">
                            `;
                        } else {
                            feedbackElement.innerHTML = `Incorrect: The correct answer was ${question['Correct Answer']}`;
                            feedbackElement.style.color = 'tomato';
                            seriesCount[series].incorrect++;
                            questionImageContainer.innerHTML = `
                                <img id="answer-image" class="answer-image" src="${getRandomImage(incorrectImages)}" alt="Answer Image">
                            `;
                        }
                        narrativeElement.innerHTML = question['Narrative'];
                        document.getElementById('next-button').style.display = 'block';
                        document.getElementById('score').textContent = `You have answered ${correctAnswers} out of ${currentQuestionIndex + 1} questions correctly`;

                        document.querySelectorAll('.answer-button').forEach(btn => {
                            btn.disabled = true;
                        });
                    });
                });

                document.getElementById('next-button').addEventListener('click', () => {
                    currentQuestionIndex++;
                    showQuestion();
                });
            }

            showQuestion();
        }

        function showQuizComplete(correctAnswers, totalQuestions, seriesCount) {
            const seriesRows = Object.entries(seriesCount).map(([series, counts]) => `
                <tr>
                    <td>${series}</td>
                    <td>${counts.total}</td>
                    <td>${counts.correct}</td>
                    <td>${counts.incorrect}</td>
                </tr>`).join('');

            document.body.innerHTML = `
                <div class="completion-title">You Have Completed the Quiz</div>
                <div class="completion-score">You Answered ${correctAnswers} Out of ${totalQuestions} Questions Correctly</div>
                <div class="completion-thank-you">Here is a summary of your results - Scroll down to play again</div>
                <div class="table-container">
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Series / Movie</th>
                                <th>Total Questions</th>
                                <th>Correct</th>
                                <th>Incorrect</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${seriesRows}
                        </tbody>
                    </table>
                </div>
                <button id="play-again-button" class="play-again-button">Play Again?</button>
                <button id="quit-button" class="quit-button">Quit</button>
            `;

            document.getElementById('play-again-button').addEventListener('click', () => {
                resetToMainPage();
            });

            document.getElementById('quit-button').addEventListener('click', () => {
                handleQuitGame();
            });
        }

        function resetToMainPage() {
            document.body.innerHTML = `
                <div class="title">Star Trek Trivia</div>
                <div class="description">
                    This may be the hardest Star Trek quiz you have ever taken.
                </div>
                <div class="question-count">
                    How Many Questions Would You Like to Play?
                </div>
                <div class="button-container">
                    <button class="question-button">10</button>
                    <button class="question-button">25</button>
                    <button class="question-button">50</button>
                </div>
            `;
            setupMainPageEventListeners();
        }

        function handleQuitGame() {
            document.body.innerHTML = `
                <div class="completion-title">Game Over</div>
                <div class="completion-score">Thank you for playing the Star Trek Trivia game!</div>
                <div class="completion-thank-you">We hope you enjoyed the game. Live long and prosper!</div>
                <div class="additional-message" style="margin-top: 20px; padding-bottom: 20px;">
                    It is planned to have a leader board added to the game sometime in the future. 
                    If you would like to help with this function, your input is welcome. 
                    Let us know in the chat how you feel you could contribute.
					
					Please close this browser window to exit.
                </div>
            `;
        }

        function getFontSizeForAnswer(text) {
            const baseFontSize = 16;
            const maxFontSize = 16;
            const minFontSize = 12;
            const maxLength = 50;
            const length = text.length;

            if (length > maxLength) {
                const reductionFactor = (length - maxLength) * 0.2;
                const newFontSize = baseFontSize - reductionFactor;
                return Math.max(minFontSize, newFontSize);
            }
            return maxFontSize;
        }

        let correctImages = [];
        let incorrectImages = [];

        function fetchAndShuffleImages() {
            const correctImagesUrl = 'https://raw.githubusercontent.com/Lead-Role/ST-Trivia/main/ST%20Trivia%20Correct%20Images%202.json';
            const incorrectImagesUrl = 'https://raw.githubusercontent.com/Lead-Role/ST-Trivia/main/ST%20Trivia%20Incorrect%20Images%202.json';

            fetch(correctImagesUrl)
                .then(response => response.json())
                .then(data => {
                    correctImages = data.sort(() => 0.5 - Math.random());
                })
                .catch(error => console.error('Error fetching correct images:', error));

            fetch(incorrectImagesUrl)
                .then(response => response.json())
                .then(data => {
                    incorrectImages = data.sort(() => 0.5 - Math.random());
                })
                .catch(error => console.error('Error fetching incorrect images:', error));
        }

        function getRandomImage(images) {
            return images[Math.floor(Math.random() * images.length)];
        }
    </script>
</body>
</html>
